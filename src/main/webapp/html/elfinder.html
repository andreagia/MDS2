<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>elFinder 2.1</title>

		<!-- jQuery and jQuery UI (REQUIRED) -->
		<link rel="stylesheet" type="text/css" href="/webjars/jquery-ui-themes/1.11.4/smoothness/jquery-ui.min.css">
		<script src="/webjars/jquery/1.12.4/jquery.min.js"></script>
		<script src="/webjars/jquery-ui/1.11.4/jquery-ui.min.js"></script>

		<!-- elFinder CSS (REQUIRED) -->
		<link rel="stylesheet" type="text/css" href="/webjars/elfinder/2.1.20/css/elfinder.min.css">
		<link rel="stylesheet" type="text/css" href="/webjars/elfinder/2.1.20/css/theme.css">

		<!-- elFinder JS (REQUIRED) -->
		<script src="/webjars/elfinder/2.1.20/js/elfinder.min.js"></script>

		<!-- elFinder translation (OPTIONAL) -->
		<script src="/webjars/elfinder/2.1.20/js/i18n/elfinder.ru.js"></script>
        <script src="/html/js/ngl/ngl.js"></script>
		<!-- elFinder initialization (REQUIRED) -->
		<script type="text/javascript" charset="utf-8">
			// Documentation for client options:
			// https://github.com/Studio-42/elFinder/wiki/Client-configuration-options
            $(document).ready(function () {

                var myCommands = Object.keys(elFinder.prototype.commands);
                var disabled = ['extract', 'archive'];
                $.each(disabled, function (i, cmd) {
                    (idx = $.inArray(cmd, myCommands)) !== -1 && myCommands.splice(idx, 1);
                });
                elfinderrel = $('#elfinder').attr('rel');

                $('#elfinder').elfinder({
                    url: '/elfinder-servlet/connector',
                    commands: myCommands,

                    getFileCallback: function(file) {

                        console.log("file");
                        console.log(file);
                        console.log(file['path']);
                        var fileel = file['path'];
                        var pdb =fileel.replace("ONEDATA","/html/data");
                        console.log(pdb);
                        stage = new NGL.Stage( "viewport" );
                        stage.viewer.container.addEventListener( "dblclick", function(){
                            stage.toggleFullscreen();
                        } );
                        function handleResize(){ stage.handleResize(); }
                        window.addEventListener( "orientationchange", handleResize, false );
                        window.addEventListener( "resize", handleResize, false );
                        stage.loadFile(  pdb, { defaultRepresentation: true } );
                        //stage.loadFile(  "/html/data/pdb/1iua.pdb", { defaultRepresentation: true } );
                        //if( blob ) load();

                    }
                /*    handlers: {
                        select: function (event, elfinderInstance) {
                            console.log(event.data);
                            console.log(event.data.selected); // selected files hashes list
                        },
                        dblclick: function (event, elfinderInstance) {
                            event.preventDefault();
                            elfinderInstance.exec('getfile')
                                .done(function () {
                                    elfinderInstance.exec('edit');
                                })
                                .fail(function () {
                                    elfinderInstance.exec('open');
                                });
                        }
                    },
                    getFileCallback: function (files, fm) {
                        return false;
                    },

                    // editor example
                    //https://github.com/Studio-42/elFinder/wiki/Using-custom-editor-to-edit-files-within-elfinder

                    commandsOptions: {
                        quicklook: {
                            width: 640,  // Set default width/height voor quicklook
                            height: 480
                        },
                        edit: {
                            mimes: [],
                            editors: [{
                                mimes: ['text/plain', 'text/html', 'text/javascript'],
                                load: function(textarea) {
                                    var mimeType = this.file.mime;
                                    return CodeMirror.fromTextArea(textarea, {
                                        mode: mimeType,
                                        lineNumbers: true,
                                        indentUnit: 4
                                    });
                                },
                                save: function(textarea, editor) {
                                    $(textarea).val(editor.getValue());
                                }
                            }]
                        }
                    }*/
                    // , lang: 'ru'                    // language (OPTIONAL)
                });


            });
		</script>
	</head>
	<body>

		<!-- Element where elFinder will be created (REQUIRED) -->
		<div id="elfinder"></div>
        <div id="viewport" class="img-responsive" style="width:100%; height:346px;"></div>
	</body>
</html>
